{% load static %}

<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static '/css/style.css' %}">
    <link rel="shortcut icon" href="{% static '/img/ico/favicon.ico' %}" type="image/x-icon">
    <title>Gest√£o Operacional</title>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo-container">
                <img src="{% static '/img/Logo_Preto.png' %}" alt="logo_grupo" id="logo_grupo">
                <p>Synchro</p>
            </div>
            <nav class="main-nav">
                <a href="#" class="menu-btn">
                    <span class="nav-icon">üë§</span>
                    Cadastrar Clientes
                </a>
                <a href="#" class="menu-btn">
                    <span class="nav-icon">üö¢</span>
                    Cadastrar Unidade
                </a>
            </nav>
            <div id="logout">
                <form action="{% url 'logout' %}" method="post">
                    {% csrf_token %}
                    <button class="Btn" type="submit">
                        <div class="sign">
                            <svg viewBox="0 0 512 512">
                                <path
                                    d="M377.9 105.9L500.7 228.7c7.2 7.2 11.3 17.1 11.3 27.3s-4.1 20.1-11.3 27.3L377.9 406.1c-6.4 6.4-15 9.9-24 9.9c-18.7 0-33.9-15.2-33.9-33.9l0-62.1-128 0c-17.7 0-32-14.3-32-32l0-64c0-17.7 14.3-32 32-32l128 0 0-62.1c0-18.7 15.2-33.9 33.9-33.9c9 0 17.6 3.6 24 9.9zM160 96L96 96c-17.7 0-32 14.3-32 32l0 256c0 17.7 14.3 32 32 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-64 0c-53 0-96-43-96-96L0 128C0 75 43 32 96 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32z">
                                </path>
                            </svg>
                        </div>
                            <div class="text">Logout</div>
                    </button>
                </form>
            </div>
        </div>
    </header>

    <main>
        <aside>
            <div class="nova_os">
                <div id="btn_right">
                    <button class="btn_os" id="btn_nova_os">Abrir nova OS</button>
            <section>
                <div id="modal-os" class="modal">
                    <div class="modal-content">
                        <span class="close-btn" onclick="fecharModal()">&times;</span>
                        <h2>Abrir OS<span id="modal-os"></span></h2>
                        <form id="form-os" method="post" action="{% url 'home' %}" enctype="multipart/form-data">
                            {% csrf_token %}

                            <fieldset class="form-section">
                                <legend>Tipo de OS</legend>
                                <div class="campo-preenchimento" id="box-opcao-container">
                                    {{ form.box_opcao }}
                                </div>
                            </fieldset>

                            <fieldset class="form-section" id="os-existente-Field">
                                <legend>Selecionar OS Existente</legend>
                                <div class="campo-preenchimento">
                                    <label for="{{ form.os_existente.id_for_label }}">OS Existente:</label>
                                    {{ form.os_existente }}
                                </div>
                            </fieldset>
                            
                            <fieldset class="form-section">
                                <legend>Cliente</legend>
                                <div class="campo-preenchimento">
                                    <label for="{{form.cliente.id_for_label}}">Cliente:</label>
                                    {{ form.cliente }}
                                </div>
                                <div class="campo-preenchimento">
                                    <label for="{{form.unidade.id_for_label}}">Unidade/Embarca√ß√£o</label>
                                    {{ form.unidade }}
                                </div>
                                <div class="campo-preenchimento">
                                    <label for="{{form.solicitante.id_for_label}}">Solicitante</label>
                                    {{ form.solicitante }}
                                </div>
                            </fieldset>
                
                            <fieldset class="form-section">
                                <legend>Opera√ß√£o</legend>
                                <div class="campo-preenchimento">
                                    <label for="{{ form.servico.id_for_label }}">Servi√ßo</label>
                                    {{ form.servico }}
                                </div>
                                <div class="campo-preenchimento">
                                    <label for="{{ form.tag.id_for_label }}">TAG:</label>
                                    {{ form.tag }}
                                </div>
                                <div class="campo-preenchimento">
                                    <label for="{{ form.metodo.id_for_label }}">M√©todo:</label>
                                    {{ form.metodo }}
                                </div>
                                <div class="campo-preenchimento">
                                    <label for="{{ form.tanque.id_for_label }}">Tanque:</label>
                                    {{ form.tanque }}
                                </div>
                                <div class="campo-preenchimento">
                                    <label for="{{ form.volume_tanque.id_for_label }}">Volume do Tanque(m¬≥):</label>
                                    {{ form.volume_tanque }}
                                </div>
                                <div class="campo-preenchimento">
                                    <label for="{{ form.especificacao.id_for_label }}">Especifica√ß√£o:</label>
                                    {{ form.especificacao }}
                                </div>
                                <div class="campo-preenchimento">
                                    <label for="{{ form.tipo_operacao.id_for_label }}">Regime de Opera√ß√£o:</label>
                                    {{ form.tipo_operacao }}
                                </div>
                                <div class="campo-preenchimento">
                                    <label for="{{ form.status_operacao.id_for_label }}">Status da opera√ß√£o:</label>
                                    {{ form.status_operacao }}
                                </div>
                                <div class="campo-preenchimento">
                                    <label for="{{ form.status_comercial.id_for_label }}">Status Comercial:</label>
                                    {{ form.status_comercial }}
                                </div>
                            </fieldset>
                            <fieldset class="form-section">
                                <legend>Data</legend>
                                <div class="campo-preenchimento">
                                    <label for="{{ form.data_inicio.id_for_label }}">Data In√≠cio</label>
                                    {{ form.data_inicio }}
                                </div>
                                <div class="campo-preenchimento">
                                    <label for="{{ form.data_fim.id_for_label }}">Data Fim:</label>
                                    {{ form.data_fim }}
                                </div>
                            </fieldset>
                            <fieldset class="form-section">
                                <legend>Equipe</legend>
                                <div class="campo-preenchimento">
                                    <label for="{{ form.pob.id_for_label }}">POB:</label>
                                    {{ form.pob }}
                                </div>
                                <div class="campo-preenchimento">
                                    <label for="{{ form.coordenador.id_for_label }}">Coordenador:</label>
                                    {{ form.coordenador }}
                                </div>
                                <div class="campo-preenchimento">
                                    <label for="{{ form.supervisor.id_for_label }}">Supervisor</label>
                                    {{ form.supervisor }}
                                </div>
                            </fieldset>
                
                            <fieldset class="form-section">
                                <legend>Documentos e Links</legend>
                                <div class="campo-preenchimento">
                                    <label for="{{ form.link_rdo.id_for_label }}">Controle de RDO:</label>
                                    {{ form.link_rdo }}
                                </div>
                            </fieldset>
                            <div class="botoes-modal">
                                <button type="submit" class="btn-confirmar">Confirmar</button>
                                <button type="button" class="btn-cancelar" onclick="fecharModal()">Cancelar</button>
                            </div>
                        </form>
                    </div>
                </div>
            </section>
        </aside>

        <aside>
            <div class="pesquisa_os">
                <button class="btn_os" id="filter-toggle" onclick="toggleFiltros()">Mostrar Filtros</button>
                <form method="get" id="pesquisa">
                    <div class="filter-panel" id="campos-filtro">
                    <div class="filter-grid">
                        <div class="filter-field">
                            <input type="text" name="codigo_os" placeholder="C√≥digo da OS" class="pesquisar_os">
                        </div>
                        <div class="filter-field">
                            <input type="text" name="cliente" placeholder="Cliente" class="pesquisar_os">
                        </div>
                        <div class="filter-field">
                            <input type="text" name="unidade" placeholder="Unidade" class="pesquisar_os">
                        </div>
                        <div class="filter-field">
                            <input type="text" name="servico" placeholder="Servi√ßo" class="pesquisar_os">
                        </div>
                        <div class="filter-field">
                            <input type="text" name="especificacao" placeholder="Especifica√ß√£o" class="pesquisar_os">
                        </div>
                        <div class="filter-field">
                            <input type="text" name="metodo" placeholder="M√©todo" class="pesquisar_os">
                        </div>
                        <div class="filter-field">
                            <input type="text" name="status_operacao" placeholder="Status da Opera√ß√£o" class="pesquisar_os">
                        </div>
                        <div class="filter-field">
                            <input type="text" name="status_comercial" placeholder="Status Comercial" class="pesquisar_os">
                        </div>
                    </div>
                    <div class="filter-buttons">
                        <button type="submit" class="btn-enviar-filtro">Filtrar</button>
                        <button type="button" class="btn-limpar-filtro" onclick="window.location.href='?';">Limpar Filtros</button>
                    </div>
                </div>
                </form>
            </div>
            <div class="tabela_conteiner">
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>C√ìDIGO DA OS</th>
                            <th>DATA IN√çCIO</th>
                            <th>DATA FIM</th>
                            <th>CLIENTE</th>
                            <th>UNIDADE</th>
                            <th>SOLICITANTE</th>
                            <th>REGIME DA OPERA√á√ÉO</th>
                            <th>SERVI√áO</th>
                            <th>TANQUE</th>
                            <th>VOLUME DO TANQUE (M¬≥)</th>
                            <th>ESPECIFICA√á√ÉO</th>
                            <th>M√âTODO DA OPERA√á√ÉO</th>
                            <th>POB</th>
                            <th>DIAS DE OPERA√á√ÉO</th>
                            <th>COORDENADOR</th>
                            <th>SUPERVISOR</th>
                            <th>STATUS DA OPERA√á√ÉO</th>
                            <th>STATUS COMERCIAL</th>
                            <th>VIS√ÉO GERAL</th>
                            <th>EDITAR</th>
                        </tr>
                    </thead>
                        <tbody>
                            {% for os in servicos %}
                            <tr>
                                <td>{{ os.id }}</td>
                                <td>{{ os.codigo_os }}</td>
                                <td>{{ os.data_inicio }}</td>
                                <td>{{ os.data_fim }}</td>
                                <td>{{ os.cliente }}</td>
                                <td>{{ os.unidade }}</td>
                                <td>{{ os.solicitante }}</td>
                                <td>{{ os.tipo_operacao }}</td>
                                <td>{{ os.servico }}</td>
                                <td>{{ os.tanque }}</td>
                                <td>{{ os.volume_tanque }}</td>
                                <td>{{ os.especificacao }}</td>
                                <td>{{ os.metodo }}</td>
                                <td>{{ os.pob }}</td>
                                <td>{{ os.dias_de_operacao }}</td>
                                <td>{{ os.coordenador }}</td>
                                <td>{{ os.supervisor }}</td>
                                <td>{{ os.status_operacao }}</td>
                                <td>{{ os.status_comercial }}</td>
                                <td>
                                    <button class="btn_tabela" data-id="{{ os.id }}"> 
                                          <svg class="plusIcon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30">
                                            <g mask="url(#mask0_21_345)">
                                            <path d="M13.75 23.75V16.25H6.25V13.75H13.75V6.25H16.25V13.75H23.75V16.25H16.25V23.75H13.75Z"></path>
                                            </g>
                                        </svg>
                                    </button>
                                </td>
                                <td>
                                    <button class="btn_tabela btn-editar" data-id="{{ os.id }}" onclick="abrirModalEdicao({{ os.id }})"><svg viewBox="0 0 512 512">
                                           <path
                                            d="M410.3 231l11.3-11.3-33.9-33.9-62.1-62.1L291.7 89.8l-11.3 11.3-22.6 22.6L58.6 322.9c-10.4 10.4-18 23.3-22.2 37.4L1 480.7c-2.5 8.4-.2 17.5 6.1 23.7s15.3 8.5 23.7 6.1l120.3-35.4c14.1-4.2 27-11.8 37.4-22.2L387.7 253.7 410.3 231zM160 399.4l-9.1 22.7c-4 3.1-8.5 5.4-13.3 6.9L59.4 452l23-78.1c1.4-4.9 3.8-9.4 6.9-13.3l22.7-9.1v32c0 8.8 7.2 16 16 16h32zM362.7 18.7L348.3 33.2 325.7 55.8 314.3 67.1l33.9 33.9 62.1 62.1 33.9 33.9 11.3-11.3 22.6-22.6 14.5-14.5c25-25 25-65.5 0-90.5L453.3 18.7c-25-25-65.5-25-90.5 0zm-47.4 168l-144 144c-6.2 6.2-16.4 6.2-22.6 0s-6.2-16.4 0-22.6l144-144c6.2-6.2 16.4-6.2 22.6 0s6.2 16.4 0 22.6z"
                                            ></path>
                                    </svg>
                                </button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>

                </table>
            </div>
            
            <div class="pagina">
                {% if servicos.has_previous %}
                    <a href="?page={{ servicos.previous_page_number }}" class="btn_os" id="pagina-btn"> ‚Üê Anterior</a>
                {% else %}
                    <span class="pagina-btn disabled">‚Üê Anterior</span>
                {% endif %}

                <span class="pagina-info">
                    P√°gina {{ servicos.number }} de {{ servicos.paginator.num_pages }}
                </span>
                
                {% if servicos.has_next %}
                    <a href="?page={{ servicos.next_page_number }}" class="btn_os" id="pagina-btn">Pr√≥xima ‚Üí</a>
                {% else %}
                    <span class="pagina-btn disabled">Pr√≥xima ‚Üí</span>
                {% endif %}
            </div>
            
            <div class="botoes_tabela">
                <button class="btn_os" id="exportar_excel">Exportar para Excel</button>
            </div>
        </aside>


        <div id="modal-edicao" class="modal">
            <div class="modal-content modal-edicao">
                <span class="close-btn" onclick="fecharModalEdicao()">&times;</span>
                <h2>Editar Ordem de Servi√ßo</h2>
                
                <div class="campos-nao-editaveis">
                    <h3>Informa√ß√µes do Sistema</h3>
                    <div class="campo-info">
                        <label><strong>N√∫mero da OS:</strong></label>
                        <span id="edit_num_os" class="valor-fixo"></span>
                    </div>
                    <div class="campo-info">
                        <label><strong>C√≥digo da OS:</strong></label>
                        <span id="edit_cod_os" class="valor-fixo"></span>
                    </div>
                    <div class="campo-info">
                        <label><strong>ID:</strong></label>
                        <span id="edit_id_os" class="valor-fixo"></span>
                    </div>
                </div>

                <form id="form-edicao" method="post" action="{% url 'editar_os_post' %}">
                    {% csrf_token %}
                    <input type="hidden" id="edit_os_id" name="os_id">
                    
                    <fieldset class="form-section">
                        <legend>Cliente</legend>
                        <div class="campo-preenchimento">
                            <label for="edit_cliente">Cliente:</label>
                            <select id="edit_cliente" name="cliente" class="form-control" required>
                                {% for value, label in form.cliente.field.choices %}
                                    <option value="{{ value }}">{{ label }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="campo-preenchimento">
                            <label for="edit_unidade">Unidade/Embarca√ß√£o:</label>
                            <input type="text" id="edit_unidade" name="unidade" class="form-control" required>
                        </div>
                        <div class="campo-preenchimento">
                            <label for="edit_solicitante">Solicitante:</label>
                            <input type="text" id="edit_solicitante" name="solicitante" class="form-control" required>
                        </div>
                    </fieldset>

                    <fieldset class="form-section">
                        <legend>Opera√ß√£o</legend>
                        <div class="campo-preenchimento">
                            <label for="edit_servico">Servi√ßo:</label>
                            <select id="edit_servico" name="servico" class="form-control" required>
                                {% for value, label in form.servico.field.choices %}
                                    <option value="{{ value }}">{{ label }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="campo-preenchimento">
                            <label for="edit_tag">TAG:</label>
                            <select id="edit_tag" name="tag" class="form-control" required>
                                {% for value, label in form.tag.field.choices %}
                                    <option value="{{ value }}">{{ label }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="campo-preenchimento">
                            <label for="edit_metodo">M√©todo:</label>
                            <select id="edit_metodo" name="metodo" class="form-control" required>
                                {% for value, label in form.metodo.field.choices %}
                                    <option value="{{ value }}">{{ label }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="campo-preenchimento">
                            <label for="edit_tanque">Tanque:</label>
                            <input type="text" id="edit_tanque" name="tanque" class="form-control" required>
                        </div>
                        <div class="campo-preenchimento">
                            <label for="edit_volume_tanque">Volume do Tanque(m¬≥):</label>
                            <input type="number" id="edit_volume_tanque" name="volume_tanque" step="0.01" class="form-control" required>
                        </div>
                        <div class="campo-preenchimento">
                            <label for="edit_especificacao">Especifica√ß√£o:</label>
                            <textarea id="edit_especificacao" name="especificacao" class="form-control" rows="3" required></textarea>
                        </div>
                        <div class="campo-preenchimento">
                            <label for="edit_tipo_operacao">Regime de Opera√ß√£o:</label>
                            <select id="edit_tipo_operacao" name="tipo_operacao" class="form-control" required>
                                {% for value, label in form.tipo_operacao.field.choices %}
                                    <option value="{{ value }}">{{ label }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="campo-preenchimento">
                            <label for="edit_status_operacao">Status da opera√ß√£o:</label>
                            <select id="edit_status_operacao" name="status_operacao" class="form-control" required>
                                {% for value, label in form.status_operacao.field.choices %}
                                    <option value="{{ value }}">{{ label }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="campo-preenchimento">
                            <label for="edit_status_comercial">Status Comercial:</label>
                            <select id="edit_status_comercial" name="status_comercial" class="form-control" required>
                                {% for value, label in form.status_comercial.field.choices %}
                                    <option value="{{ value }}">{{ label }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </fieldset>

                    <fieldset class="form-section">
                        <legend>Datas</legend>
                        <div class="campo-preenchimento">
                            <label for="edit_data_inicio">Data In√≠cio:</label>
                            <input type="date" id="edit_data_inicio" name="data_inicio" class="form-control" required>
                        </div>
                        <div class="campo-preenchimento">
                            <label for="edit_data_fim">Data Fim:</label>
                            <input type="date" id="edit_data_fim" name="data_fim" class="form-control" required>
                        </div>
                    </fieldset>

                    <fieldset class="form-section">
                        <legend>Equipe</legend>
                        <div class="campo-preenchimento">
                            <label for="edit_pob">POB:</label>
                            <input type="number" id="edit_pob" name="pob" class="form-control" required>
                        </div>
                        <div class="campo-preenchimento">
                            <label for="edit_coordenador">Coordenador:</label>
                            <input type="text" id="edit_coordenador" name="coordenador" class="form-control" required>
                        </div>
                        <div class="campo-preenchimento">
                            <label for="edit_supervisor">Supervisor:</label>
                            <input type="text" id="edit_supervisor" name="supervisor" class="form-control" required>
                        </div>
                    </fieldset>

                    <fieldset class="form-section">
                        <legend>Hist√≥rico</legend>
                        <div class="campo-preenchimento">
                            <label for="edit_observacoes"></label>
                            <textarea id="edit_observacoes" name="observacao" class="form-control" rows="4"></textarea>
                        </div>
                    </fieldset>

                    <fieldset class="form-section">
                        <legend>Documentos e Links</legend>
                        <div class="campo-preenchimento">
                            <label for="edit_link_rdo">Controle de RDO:</label>
                            <input type="url" id="edit_link_rdo" name="link_rdo" class="form-control">
                        </div>
                    </fieldset>

                    <div class="botoes-modal">
                        <button type="button" class="btn-confirmar" onclick="handleEditFormSubmit()">Salvar Altera√ß√µes</button>
                        <button type="button" class="btn-cancelar" onclick="fecharModalEdicao()">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>

        <aside>
            <div id="detalhes_os" class="detalhes">
                <div class="modal-detalhes">
                    <div id="relatorio-os">
                        <span class="close-btn" onclick="fecharDetalhesModal()">&times;</span>
                        <h2>Relat√≥rio de Ordem de Servi√ßo</h2>
                        <div class="secao">
                            <h3>Informa√ß√µes Gerais</h3>
                            <div class="grid-detalhes">
                                <div><strong>N√∫mero da OS:</strong> <span id="num_os"></span></div>
                                <div><strong>TAG:</strong> <span id="tag"></span></div>
                                <div><strong>C√≥digo da OS:</strong> <span id="cod_os"></span></div>
                                <div><strong>ID:</strong> <span id="id_os"></span></div>
                                <div><strong>Status da opera√ß√£o:</strong> <span id="status_os"></span></div>
                                <div><strong>Status comercial:</strong> <span id="status_comercial"></span></div>
                            </div>
                        </div>
                        <div class="secao">
                            <h3>Datas</h3>
                            <div class="grid-detalhes">
                                <div><strong>Data In√≠cio:</strong> <span id="data_inicio"></span></div>
                                <div><strong>Data Fim:</strong> <span id="data_fim"></span></div>
                                <div><strong>Dias de opera√ß√£o:</strong> <span id="dias_op"></span></div>
                            </div>
                        </div>
                        <div class="secao">
                            <h3>Cliente e Local</h3>
                            <div class="grid-detalhes">
                                <div><strong>Cliente:</strong> <span id="cliente"></span></div>
                                <div><strong>Unidade:</strong> <span id="unidade"></span></div>
                                <div><strong>Solicitante:</strong> <span id="solicitante"></span></div>
                            </div>
                        </div>
                        <div class="secao">
                            <h3>Servi√ßo e Opera√ß√£o</h3>
                            <div class="grid-detalhes">
                                <div><strong>Regime da Opera√ß√£o:</strong> <span id="regime"></span></div>
                                <div><strong>Servi√ßo:</strong> <span id="servico"></span></div>
                                <div><strong>M√©todo da opera√ß√£o:</strong> <span id="metodo"></span></div>
                            </div>
                        </div>
                        <div class="secao">
                            <h3>Tanque</h3>
                            <div class="grid-detalhes">
                                <div><strong>Tanque:</strong> <span id="tanque"></span></div>
                                <div><strong>Volume do Tanque(m¬≥):</strong> <span id="volume_tq"></span></div>
                                <div><strong>Especifica√ß√£o:</strong> <span id="especificacao"></span></div>
                            </div>
                        </div>
                        <div class="secao">
                            <h3>Equipe</h3>
                            <div class="grid-detalhes">
                                <div><strong>POB:</strong> <span id="pob"></span></div>
                                <div><strong>Coordenador:</strong> <span id="coordenador"></span></div>
                                <div><strong>Supervisor:</strong> <span id="supervisor"></span></div>
                            </div>
                        </div>
                        <div class="secao">
                            <h3>Hist√≥rico:</h3>
                            <div class="observacao">
                                <span id="observacao" rowspan="4"></span>
                            </div>
                        </div>
                        <div class="secao">
                            <h3>Arquivos Anexados</h3>
                            <ul class="anexos">
                                <li><a href="#">Controle de RDO</a></li>
                                <li><a href="#">Controle de Log√≠stica de Pessoal</a></li>
                                <li><a href="#">Controle de materiais/equipamento</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </aside>
    </main>
    <footer>
        <p>¬© 2025 Ambipar. Vers√£o 1.0</p>
    </footer>
      <script src="{% static 'js/scripts.js'%}"></script>
</body>
</html>