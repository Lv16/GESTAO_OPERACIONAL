{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'css/notifications.css' %}">
    <link rel="stylesheet" href="{% static 'css/loading.css' %}">
    <link rel="stylesheet" href="{% static 'css/logout.css' %}">
    <link rel="stylesheet" href="{% static 'css/os-popover.css' %}">
    <link rel="shortcut icon" href="{% static 'img/ico/favicon.ico' %}" type="image/x-icon">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <title>Ambipar - Synchro</title>
</head>
<body>
    <div class="loading-screen" id="loadingScreen">
        <div class="welcome-message">Bem-vindo ao Sistema Ambipar Synchro</div>
        <div class="subtitle-message">Aguarde enquanto preparamos sua experi√™ncia...</div>
        <div class="barco-container">
            <img src="{% static 'img/industrial.png' %}" alt="Barco industrial" class="barco" />
            <div class="fumaca">
                <div class="fumaca-bolha f1"></div>
                <div class="fumaca-bolha f2"></div>
                <div class="fumaca-bolha f3"></div>
            </div>
            <div class="agua-ondas">
                <svg class="ondinhas-svg" viewBox="0 0 420 32" width="420" height="32" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M0 16 Q 21 0 42 16 T 84 16 T 126 16 T 168 16 T 210 16 T 252 16 T 294 16 T 336 16 T 378 16 T 420 16" stroke="#111" stroke-width="6" fill="none" stroke-linecap="round"/>
                </svg>
            </div>
        </div>
    </div>

    <div class="logout-overlay" id="logoutOverlay">
        <div class="logout-content">
            <div class="logout-icon">üëã</div>
            <div class="logout-message">At√© logo!</div>
            <div class="logout-subtext">Voc√™ est√° sendo desconectado...</div>
        </div>
    </div>

    <!-- Drawer lateral -->
    <nav class="drawer-nav" id="drawer-nav">
        <a href="/" class="menu-btn">
            <span class="nav-icon material-icons">home</span>
            Home
        </a>
        <div class="drawer-separator"></div>
        <a href="{% url 'cadastrar_usuario' %}" class="menu-btn">
            <span class="nav-icon">üë§</span>
            Cadastrar Usu√°rio
        </a>
        <div class="drawer-separator"></div>
        <a href="{% url 'cadastrar_pessoa' %}" class="menu-btn">
            <span class="nav-icon">üßæ</span>
            Cadastrar Pessoa
        </a>
        <div class="drawer-separator"></div>
        <a href="{% url 'cadastrar_funcao' %}" class="menu-btn">
            <span class="nav-icon">üè∑Ô∏è</span>
            Cadastrar Fun√ß√£o
        </a>
        <div class="drawer-separator"></div>
        <a href="{% url 'cadastrar_cliente' %}" class="menu-btn">
            <span class="nav-icon">‚ûï</span>
            Cadastrar Cliente
        </a>
        <div class="drawer-separator"></div>
        <a href="{% url 'cadastrar_unidade' %}" class="menu-btn">
            <span class="nav-icon">üö¢</span>
            Cadastrar Unidade
        </a>
        <div class="drawer-separator"></div>
        <a href="{% url 'rdo' %}" class="menu-btn">
            <span class="nav-icon">üìã</span>
            Relat√≥rio Di√°rio de Opera√ß√£o
        </a>
        <div class="drawer-separator"></div>
        <a href="{% url 'equipamentos' %}" class="menu-btn">
            <span class="nav-icon">üõ†Ô∏è</span>
            Equipamentos
        </a>
        <div class="drawer-separator"></div>
        <a href="{% url 'rdo_dashboard' %}" class="menu-btn">
            <span class="nav-icon material-icons">üìä</span>
            Dashboard RDO
                </a>
        <div class="drawer-separator"></div>
        <a href="{% url 'ajuda' %}" class="menu-btn ajuda-link">
            <span class="nav-icon material-icons">help_outline</span>
            Ajuda
        </a>

    </nav>

    <div class="site-wrapper" id="site-wrapper">
        <header>
            <div class="header-content">
                <div class="hamburger" id="hamburger-menu" aria-label="Abrir menu" tabindex="0">
                    <svg width="38" height="38" viewBox="0 0 38 38" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="5" y="8" width="28" height="6" rx="3" fill="#111"/>
                        <rect x="5" y="16" width="28" height="6" rx="3" fill="#111"/>
                        <rect x="5" y="24" width="28" height="6" rx="3" fill="#111"/>
                    </svg>
                </div>
                <div class="logo-container">
                    <a href = ''>
                        <img src="{% static 'img/logo_home.png' %}" alt="logo_grupo" id="logo_grupo">
                    </a>
                </div>
                <div id="logout">
                    <form id="logoutForm" class="no-loading" action="{% url 'logout' %}" method="post">
                        {% csrf_token %}
                        <button class="Btn" type="submit">
                            <div class="sign">
                                <svg viewBox="0 0 512 512">
                                    <path
                                    d="M377.9 105.9L500.7 228.7c7.2 7.2 11.3 17.1 11.3 27.3s-4.1 20.1-11.3 27.3L377.9 406.1c-6.4 6.4-15 9.9-24 9.9c-18.7 0-33.9-15.2-33.9-33.9l0-62.1-128 0c-17.7 0-32-14.3-32-32l0-64c0-17.7 14.3-32 32-32l128 0 0-62.1c0-18.7 15.2-33.9 33.9-33.9c9 0 17.6 3.6 24 9.9zM160 96L96 96c-17.7 0-32 14.3-32 32l0 256c0 17.7 14.3 32 32 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-64 0c-53 0-96-43-96-96L0 128C0 75 43 32 96 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32z">
                                    </path>
                                </svg>
                            </div>
                            <div class="text">Logout</div>
                        </button>
                    </form>
                </div>
                <!-- Bot√£o da dashboard removido do header (substitu√≠do por FAB flutuante) -->
            </div>
        </header>

        <!-- Mobile bottom navigation (substitui hamburger no mobile) -->
        <nav class="mobile-bottom-nav" id="mobile-bottom-nav" aria-label="Navega√ß√£o m√≥vel">
            <a href="/" class="mobile-nav-btn" aria-label="Home">
                <span class="material-icons" aria-hidden="true">home</span>
                <span class="label">Home</span>
            </a>
            <a href="{% url 'rdo' %}" class="mobile-nav-btn" aria-label="RDO">
                <span class="material-icons" aria-hidden="true">description</span>
                <span class="label">RDO</span>
            </a>
            <a href="{% url 'equipamentos' %}" class="mobile-nav-btn" aria-label="Equipamentos">
                <span class="material-icons" aria-hidden="true">build</span>
                <span class="label">Equip.</span>
            </a>
            <a href="{%url 'rdo_dashboard' %}" class="mobile-nav-btn" id="mobile-dashboard-toggle" aria-label="Dashboard RDO">
                <span class="material-icons" aria-hidden="true">analytics</span>
                <span class="label">Dash.RDO</span>
            </a>
            <button class="mobile-nav-btn" id="mobile-open-menu" aria-label="Mais op√ß√µes">
                <span class="material-icons" aria-hidden="true">menu</span>
                <span class="label">Mais</span>
            </button>
        </nav>

        <!-- Mobile full menu sheet (cont√©m as mesmas op√ß√µes do drawer) -->
        <div id="mobile-full-menu" class="mobile-sheet" role="dialog" aria-modal="true" aria-hidden="true">
            <div class="mobile-sheet-header">
                <button id="mobile-full-menu-close" class="mobile-sheet-close" aria-label="Fechar menu">&times;</button>
                <h3>Menu</h3>
            </div>
            <div class="mobile-sheet-body">
                <nav class="mobile-sheet-nav">
                    <a href="/" class="menu-btn"><span class="nav-icon material-icons">home</span> Home</a>
                    <a href="{% url 'cadastrar_usuario' %}" class="menu-btn"><span class="nav-icon">üë§</span> Cadastrar Usu√°rio</a>
                    <a href="{% url 'cadastrar_pessoa' %}" class="menu-btn"><span class="nav-icon">üßæ</span> Cadastrar Pessoa</a>
                    <a href="{% url 'cadastrar_funcao' %}" class="menu-btn"><span class="nav-icon">üè∑Ô∏è</span> Cadastrar Fun√ß√£o</a>
                    <a href="{% url 'cadastrar_cliente' %}" class="menu-btn"><span class="nav-icon">‚ûï</span> Cadastrar Cliente</a>
                    <a href="{% url 'cadastrar_unidade' %}" class="menu-btn"><span class="nav-icon">üö¢</span> Cadastrar Unidade</a>
                    <a href="{% url 'rdo' %}" class="menu-btn"><span class="nav-icon">üìã</span> Relat√≥rio Di√°rio de Opera√ß√£o</a>
                    <a href="{% url 'equipamentos' %}" class="menu-btn"><span class="nav-icon">üõ†Ô∏è</span> Equipamentos</a>
                    <a href="{% url 'rdo_dashboard' %}" class="menu-btn"><span class="nav-icon material-icons">üìä</span> Dashboard RDO</a>
                    <a href="{% url 'ajuda' %}" class="menu-btn ajuda-link"><span class="nav-icon material-icons">help_outline</span> Ajuda</a>
                </nav>
            </div>
        </div>

    <main>
        <!-- Datalists globais para valida√ß√£o/sugest√£o -->
        {% if clientes %}
        <datalist id="clientes_datalist">
            {% for c in clientes %}
                <option value="{{ c.nome }}"></option>
            {% endfor %}
        </datalist>
        {% endif %}
        {% if unidades %}
        <datalist id="unidades_datalist">
            {% for u in unidades %}
                <option value="{{ u.nome }}"></option>
            {% endfor %}
        </datalist>
        {% endif %}
        {% comment %} Datalist de servi√ßos (para sele√ß√£o em vez de digitar) {% endcomment %}
        {% if form.servico %}
        <datalist id="servicos_datalist">
            {% for value, label in form.servico.field.choices %}
                <option value="{{ label }}"></option>
            {% endfor %}
        </datalist>
        {% endif %}

    <!-- Painel da Dashboard embutida (vis√≠vel via bot√£o) -->
    <section id="dashboard-panel" class="dashboard-panel">
            <div class="kpis">
                <div class="kpi-card" id="kpi-total">Total OS<br><strong id="kpi-total-val">‚Äî</strong></div>
                <div class="kpi-card" id="kpi-abertas">OS Abertas<br><strong id="kpi-abertas-val">‚Äî</strong></div>
                <div class="kpi-card" id="kpi-concluidas">Conclu√≠das no m√™s<br><strong id="kpi-concluidas-val">‚Äî</strong></div>
                <div class="kpi-card" id="kpi-media">Tempo m√©dio (dias)<br><strong id="kpi-media-val">‚Äî</strong></div>
                <!-- Card de total de supervisores movido para dentro da se√ß√£o 'Supervisores' (ver abaixo) -->
            </div>
            <!-- Breakdown por status operacional (Programada / Em Andamento / Paralizada / Finalizada) -->
            <div class="kpi-status-breakdown" id="kpi-status-breakdown" style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap">
                <div class="kpi-card small" id="kpi-status-programada">Programada<br><strong id="kpi-status-programada-val">‚Äî</strong></div>
                <div class="kpi-card small" id="kpi-status-em-andamento">Em Andamento<br><strong id="kpi-status-em-andamento-val">‚Äî</strong></div>
                <div class="kpi-card small" id="kpi-status-paralizada">Paralizada<br><strong id="kpi-status-paralizada-val">‚Äî</strong></div>
                <div class="kpi-card small" id="kpi-status-finalizada">Finalizada<br><strong id="kpi-status-finalizada-val">‚Äî</strong></div>
            </div>

            <!-- Nota: os inputs de filtro s√£o injetados dinamicamente por static/js/dashboard.js para reusar os datalists j√° presentes na p√°gina -->

            <div class="charts-grid">
                <div class="chart-card">
                    <h3 class="chart-title">Ordens por dia</h3>
                    <canvas id="chartOrdens" height="140"></canvas>
                </div>
                <div class="chart-card">
                    <h3 class="chart-title">Status das OS</h3>
                    <canvas id="chartStatus" height="140"></canvas>
                </div>
                <div class="chart-card">
                    <h3 class="chart-title">Supervisores (Embarque)</h3>
                    <canvas id="chartSupervisores" height="140"></canvas>
                    <!-- Mostrar apenas contagens resumidas para evitar lista longa -->
                    <div class="kpi-status-breakdown" style="margin-top:8px;">
                        <div class="kpi-card small" id="kpi-supervisores-em">Embarque<br><strong id="kpi-supervisores-em-val">‚Äî</strong></div>
                        <div class="kpi-card small" id="kpi-supervisores-disponiveis">Dispon√≠veis<br><strong id="kpi-supervisores-disponiveis-val">‚Äî</strong></div>
                            <!-- Card resumo: total de supervisores (mant√©m o mesmo id usado pelo JS) -->
                            <div class="kpi-card small" id="kpi-supervisores-total">Total Supervisores<br><strong id="kpi-supervisores-total-val">‚Äî</strong></div>
                    </div>
                </div>
                <div class="chart-card span-2">
                    <div class="charts-subgrid">
                        <div class="chart-card small">
                            <h3 class="chart-title">Top Clientes</h3>
                            <canvas id="chartTopClientes" height="120"></canvas>
                        </div>
                        
                        <div class="chart-card small">
                            <h3 class="chart-title">M√©todos mais utilizados</h3>
                            <canvas id="chartMetodos" height="120"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <aside>
            <div class="nova_os">
                <div id="btn_right">
                    <button class="btn_os" id="btn_nova_os">Abrir nova OS</button>
                    <section>
                        <div id="modal-os" class="modal">
                            <div class="modal-content">
                                <span class="close-btn" onclick="fecharModal()">&times;</span>
                                <h2>Abrir OS<span id="modal-os-title"></span></h2>
                                <form id="form-os" method="post" action="{% url 'lista_servicos' %}" enctype="multipart/form-data" data-ajax="true" autocomplete="off">
                                    {% csrf_token %}

                                    <!-- Prevent browser/Google autofill dropdown: hidden off-screen input to capture autofill -->
                                    <input type="text" name="prevent_autofill" autocomplete="off" tabindex="-1" style="position:absolute;left:-9999px;top:-9999px;opacity:0;" />

                                    <fieldset class="form-section">
                                        <legend>Tipo de OS</legend>
                                        <div class="campo-preenchimento" id="box-opcao-container">
                                            {{ form.box_opcao }}
                                        </div>
                                    </fieldset>

                                    <fieldset class="form-section" id="os-existente-Field">
                                        <legend>Selecionar OS Existente</legend>
                                        <div class="campo-preenchimento">
                                            <label for="{{ form.os_existente.id_for_label }}">OS Existente:</label>
                                            <div class="os-widget">
                                                <div id="os-inline-list" class="os-inline-list" aria-live="polite"></div>
                                                <button type="button" id="os-ver-mais-btn" class="os-button">
                                                    <span class="button__text">Ver mais</span>
                                                    <span class="button__icon" aria-hidden="true">
                                                        <svg class="svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="16" height="16" aria-hidden="true">
                                                            <line x1="12" y1="5" x2="12" y2="19"></line>
                                                            <line x1="5" y1="12" x2="19" y2="12"></line>
                                                        </svg>
                                                    </span>
                                                </button>

                                                <div id="os-popover" class="os-popover" role="dialog" aria-modal="false" hidden>
                                                    <div class="os-popover-header">
                                                        <input id="os-popover-search" class="os-popover-search" placeholder="Pesquisar OS..." aria-label="Pesquisar OS">
                                                        <button type="button" id="os-popover-close" class="os-popover-close" aria-label="Fechar">‚úï</button>
                                                    </div>
                                                    <div id="os-popover-list" class="os-popover-list" role="listbox" tabindex="0"></div>
                                                </div>

                                                <div style="display:none;">{{ form.os_existente }}</div>
                                            </div>
                                        </div>
                                    </fieldset>
                                    
                                    <fieldset class="form-section">
                                        <legend>Cliente</legend>
                                        <div class="campo-preenchimento">
                                            <label for="id_cliente">Cliente:</label>
                                            <input type="text" id="id_cliente" name="Cliente" class="form-control" list="clientes_datalist" placeholder="Selecione um cliente cadastrado" required autocomplete="off">
                                        </div>
                                        <div class="campo-preenchimento">
                                            <label for="id_unidade">Unidade/Embarca√ß√£o</label>
                                            <input type="text" id="id_unidade" name="Unidade" class="form-control" list="unidades_datalist" placeholder="Selecione uma unidade cadastrada" required autocomplete="off">
                                        </div>
                                        <div class="campo-preenchimento">
                                            <label for="{{form.solicitante.id_for_label}}">Solicitante</label>
                                            {{ form.solicitante }}
                                        </div>
                                    </fieldset>
                        
                                    <fieldset class="form-section">
                                        <legend>Opera√ß√£o</legend>
                                        <div class="campo-preenchimento">
                                            <label for="servico_input">Servi√ßo (selecione um ou mais)</label>
                                            <!-- input vis√≠vel para sele√ß√£o via datalist -->
                                            <input type="text" id="servico_input" class="form-control" list="servicos_datalist" placeholder="Selecione servi√ßos (aperte Enter ou +)" autocomplete="off">
                                            <!-- campo oculto que ser√° enviado no formul√°rio com a lista separada por v√≠rgula -->
                                            <input type="hidden" id="servico_hidden" name="servico" value="">
                                            <div id="servico_tags_container" class="tags-container"></div>
                                        </div>
                                        <div class="campo-preenchimento">
                                            <label for="{{ form.metodo.id_for_label }}">M√©todo Prim√°rio:</label>
                                            {{ form.metodo }}
                                        </div>
                                        <div class="campo-preenchimento">
                                            <label for="{{ form.metodo_secundario.id_for_label }}">M√©todo Secund√°rio (Se Houver):</label>
                                            {{ form.metodo_secundario }}
                                        </div>
                                        <div class="campo-preenchimento">
                                            <label>Tanques (um por servi√ßo):</label>
                                            <!-- Container onde o JS criar√° uma linha de inputs Tanque+Volume para cada servi√ßo -->
                                            <div id="tanques_container" class="tanques-container"></div>
                                            <!-- Hidden field que ser√° enviado ao servidor: lista CSV de tanques -->
                                            <input type="hidden" id="tanques_hidden" name="tanques" value="">
                                        </div>
                                        <div class="campo-preenchimento">
                                            <label for="id_po">PO:</label>
                                            <input type="text" id="id_po" name="po" class="form-control" placeholder="N√∫mero PO">
                                        </div>
                                        <div class="campo-preenchimento">
                                            <label for="id_material">Material:</label>
                                            <select id="id_material" name="material" class="form-control">
                                                <option value="">---</option>
                                                <option value="A Bordo">A Bordo</option>
                                                <option value="Embarcar">Embarcar</option>
                                                <option value="Desembarcar">Desembarcar</option>
                                            </select>
                                        </div>
                                        <div class="campo-preenchimento">
                                            <label for="{{ form.especificacao.id_for_label }}">Especifica√ß√£o:</label>
                                            {{ form.especificacao }}
                                        </div>
                                        <div class="campo-preenchimento">
                                            <label for="{{ form.tipo_operacao.id_for_label }}">Regime de Opera√ß√£o:</label>
                                            {{ form.tipo_operacao }}
                                        </div>
                                        <div class="campo-preenchimento">
                                            <label for="id_turno">Turno:</label>
                                            <select id="id_turno" name="turno" class="form-control">
                                                <option value="">---</option>
                                                <option value="Diurno">Diurno</option>
                                                <option value="Noturno">Noturno</option>
                                            </select>
                                        </div>
                                        <div class="campo-preenchimento">
                                            <label for="{{ form.status_operacao.id_for_label }}">Status da opera√ß√£o:</label>
                                            {{ form.status_operacao }}
                                        </div>
                                        <div class="campo-preenchimento">
                                            <label for="{{ form.status_geral.id_for_label }}">Status da movimenta√ß√£o:</label>
                                            {{ form.status_geral }}
                                        </div>
                                        <div class="campo-preenchimento">
                                            <label for="{{ form.status_planejamento.id_for_label }}">Status Planejamento:</label>
                                            {{ form.status_planejamento }}
                                        </div>
                                        <div class="campo-preenchimento">
                                            <label for="{{ form.status_comercial.id_for_label }}">Medi√ß√£o</label>
                                            {{ form.status_comercial }}
                                        </div>
                                        <div class="campo-preenchimento">
                                            <label for="id_status_databook">Status Databook</label>
                                            <select id="id_status_databook" name="status_databook" class="form-control">
                                                <option value="">---</option>
                                                <option value="N√£o Aplic√°vel">N√£o Aplic√°vel</option>
                                                <option value="Em Andamento">Em Andamento</option>
                                                <option value="Finalizado">Finalizado</option>
                                            </select>
                                        </div>
                                        <div class="campo-preenchimento">
                                            <label for="id_numero_certificado">N√∫mero do Certificado</label>
                                            <input type="number" id="id_numero_certificado" name="numero_certificado" class="form-control" placeholder="N√∫mero do certificado" inputmode="numeric" pattern="\d*" step="1">
                                        </div>
                                    </fieldset>
                                    <fieldset class="form-section">
                                        <legend>Data</legend>
                                        <div class="campo-preenchimento">
                                            <label for="{{ form.data_inicio.id_for_label }}">Data In√≠cio da opera√ß√£o (programada)</label>
                                            {{ form.data_inicio }}
                                        </div>
                                        <div class="campo-preenchimento">
                                            <label for="{{ form.data_fim.id_for_label }}">Data Fim da opera√ß√£o:</label>
                                            {{ form.data_fim }}
                                        </div>
                                        <div class="campo-preenchimento">
                                            <label for="id_data_inicio_frente">Data In√≠cio da movimenta√ß√£o</label>
                                            <input type="date" id="id_data_inicio_frente" name="data_inicio_frente" class="form-control">
                                        </div>
                                        <div class="campo-preenchimento">
                                            <label for="id_data_fim_frente">Data Fim da movimenta√ß√£o</label>
                                            <input type="date" id="id_data_fim_frente" name="data_fim_frente" class="form-control">
                                        </div>
                                        <!-- campo 'frente' gerenciado automaticamente pelo sistema; removido do formul√°rio -->
                                    </fieldset>
                                    <fieldset class="form-section">
                                        <legend>Equipe</legend>
                                        <div class="campo-preenchimento">
                                            <label for="{{ form.pob.id_for_label }}">POB:</label>
                                            {{ form.pob }}
                                        </div>
                                        <div class="campo-preenchimento">
                                            <label for="{{ form.coordenador.id_for_label }}">Coordenador - Ambipar:</label>
                                            {{ form.coordenador }}
                                        </div>
                                        <div class="campo-preenchimento">
                                            <label for="{{ form.supervisor.id_for_label }}">Supervisor</label>
                                            {{ form.supervisor }}
                                        </div>
                                    </fieldset>
                                    <div class="botoes-modal">
                                        <button type="submit" class="btn-confirmar">Confirmar</button>
                                        <button type="button" class="btn-cancelar" onclick="fecharModal()">Cancelar</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </section>
                </div> 
            </div>    
        </aside>

        <aside>
            <div class="pesquisa_os">
                <button class="btn_os" id="filter-toggle" onclick="toggleFiltros()">
                    <span class="material-icons">filter_alt</span>
                    <span>Filtros</span>
                </button>
                <form method="get" id="pesquisa">
                    <div class="filter-panel-modern" id="campos-filtro">
                        <div class="filter-header">
                            <button type="button" class="close-filter" onclick="toggleFiltros()">
                                <span class="material-icons">close</span>
                            </button>
                        </div>
                        <div class="filter-grid-modern">
                            <div class="filter-card">
                                <span class="material-icons">confirmation_number</span>
                                <input type="text" name="numero_os" placeholder="OS">
                            </div>
                            <div class="filter-card">
                                <span class="material-icons">person</span>
                                <input type="text" name="cliente" placeholder="Cliente">
                            </div>
                            <div class="filter-card">
                                <span class="material-icons">business</span>
                                <input type="text" name="unidade" placeholder="Unidade">
                            </div>
                            <div class="filter-card">
                                <span class="material-icons">build</span>
                                <input type="text" name="servico" placeholder="Servi√ßo">
                            </div>
                            <div class="filter-card">
                                <span class="material-icons">description</span>
                                <input type="text" name="especificacao" placeholder="Especifica√ß√£o">
                            </div>
                            <div class="filter-card">
                                <span class="material-icons">science</span>
                                <input type="text" name="metodo" placeholder="M√©todo">
                            </div>
                            <div class="filter-card">
                                <span class="material-icons">sync_alt</span>
                                <input type="text" name="status_operacao" placeholder="Status da Opera√ß√£o">
                            </div>
                            <div class="filter-card">
                                <span class="material-icons">playlist_add_check</span>
                                <input type="text" name="status_planejamento" placeholder="Status Planejamento">
                            </div>
                            <div class="filter-card">
                                <span class="material-icons">attach_money</span>
                                <input type="text" name="status_comercial" placeholder="Status Comercial">
                            </div>
                            <div class="filter-card">
                                <span class="material-icons">supervisor_account</span>
                                <input type="text" name="coordenador" placeholder="Coordenador">
                            </div>
                            <div class="filter-card">
                                <span class="material-icons">schedule</span>
                                <input type="text" name="turno" placeholder="Turno">
                            </div>
                            <div class="filter-card filtro-data" id="filtro-data-inicial">
                                <span class="material-icons">event</span>
                                <label for="data_inicial">In√≠cio da opera√ß√£o</label>
                                <input type="date" id="data_inicial" name="data_inicial" placeholder="Data In√≠cio">
                            </div>
                            <div class="filter-card filtro-data" id="filtro-data-final">
                                <span class="material-icons">event</span>
                                <label for="data_final">Fim da opera√ß√£o</label>
                                <input type="date" id="data_final" name="data_final" placeholder="Data Fim">
                            </div>
                        </div>
                        <div class="filter-actions">
                            <button type="submit" class="btn-enviar-filtro-modern">
                                <span class="material-icons">search</span> Filtrar
                            </button>
                            <button type="button" class="btn-limpar-filtro-modern" id="btn-limpar-filtros">
                                <span class="material-icons">clear_all</span> Limpar
                            </button>
                            <button type="button" class="btn-filtro-data" id="btn-toggle-datas">
                                <span class="material-icons">date_range</span> Datas
                            </button>
                            
                        </div>
                    </div>
                </form>
            </div>

            <div id="painel-filtros">
            </div>
            {% if filtros_ativos %}
            <div id="filtros-ativos-bar">
                <span class="filtros-label">Filtros ativos:</span>
                {% if filtros_ativos.data_inicial or filtros_ativos.data_final %}
                    {% if filtros_ativos.data_inicial and filtros_ativos.data_final %}
                        <span class="filtro-chip filtro-chip-data">
                            <span class="material-icons">date_range</span>
                            <span>Per√≠odo: {{ filtros_ativos.data_inicial|date:'d/m/Y' }} a {{ filtros_ativos.data_final|date:'d/m/Y' }}</span>
                            <button id="btn-limpar-datas-chip" type="button" title="Limpar datas" class="btn-clear-datas-chip">‚úï</button>
                        </span>
                    {% elif filtros_ativos.data_inicial %}
                        <span class="filtro-chip filtro-chip-data">
                            <span class="material-icons">date_range</span>
                            <span>In√≠cio: {{ filtros_ativos.data_inicial|date:'d/m/Y' }}</span>
                            <button id="btn-limpar-datas-chip" type="button" title="Limpar datas" class="btn-clear-datas-chip">‚úï</button>
                        </span>
                    {% elif filtros_ativos.data_final %}
                        <span class="filtro-chip filtro-chip-data">
                            <span class="material-icons">date_range</span>
                            <span>Fim: {{ filtros_ativos.data_final|date:'d/m/Y' }}</span>
                            <button id="btn-limpar-datas-chip" type="button" title="Limpar datas" class="btn-clear-datas-chip">‚úï</button>
                        </span>
                    {% endif %}
                {% endif %}
                {% for nome, valor in filtros_ativos.items %}
                    {% if nome != 'data_inicial' and nome != 'data_final' and valor %}
                        <span class="filtro-chip">
                            <span>{{ nome }}:</span> <span>{{ valor }}</span>
                        </span>
                    {% endif %}
                {% endfor %}
                <button class="btn-limpar-filtros-bar" type="button" title="Limpar todos os filtros">Limpar filtros ‚úï</button>
            </div>
            {% endif %}
        
            <div class="tabela_conteiner">
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>OS</th>
                            <th>Empresa</th>
                            <th>Unidade</th>
                            <th>Servi√ßo</th>
                            <th>M√©todo</th>
                            <th>Tanque</th>
                            <th>Especifica√ß√£o</th>
                            <th>POB</th>
                            <th>Data In√≠cio da opera√ß√£o</th>
                            <th>Data Fim da opera√ß√£o</th>
                            <th>QTD de Dias da opera√ß√£o</th>
                            <th>Sequ√™ncia da movimenta√ß√£o</th>
                            <th>Data In√≠cio da Movimenta√ß√£o</th>
                            <th>Data Fim da Movimenta√ß√£o</th>
                            <th>QTD de Dias da Movimenta√ß√£o</th>
                            <th>Turno</th>
                            <th>Solicitante</th>
                            <th>Supervisor</th>
                            <th>Coordenador</th>
                            <th>Contrato / PO</th>
                            <th>Status Linha (movimenta√ß√£o)</th>
                            <th>Status Planejamento</th>
                            <th>Status Opera√ß√£o</th>
                            <th>Material / Equipamento</th>
                            <th>Medi√ß√£o</th>
                            <th>Status Databook</th>
                            <th>N¬∫ Certificado</th>
                            <th>Editar</th>
                            <th>Log√≠stica</th>
                            <th>Vis√£o Geral</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for os in servicos %}
                        <tr data-cliente="{{ os.cliente|default:''|escape }}" data-unidade="{{ os.unidade|default:''|escape }}" data-status="{{ os.status_operacao|default:''|lower }}" data-status-planejamento="{{ os.status_planejamento|default:''|lower }}" data-numero-os="{{ os.numero_os|default:''|escape }}">
                            <td>{{ os.id }}</td>
                            <td>{{ os.numero_os }}</td>
                            <td>{{ os.cliente|default:"-" }}</td>
                            <td>{{ os.unidade|default:"-" }}</td>
                            <td class="td-servicos" data-servicos="{{ os.servicos|default:os.servico|escape }}" data-primary="{{ os.servico|default:''|escape }}" title="Servi√ßos">
                                <div class="servicos-chips" aria-hidden="false">
                                    <noscript><span class="servico-chip">{{ os.servico }}</span></noscript>
                                </div>
                            </td>
                            <td>{{ os.metodo|default:"-" }}</td>
                            <td class="td-tanques" data-tanques="{{ os.tanques|default:os.tanque|escape }}" title="Tanques">
                                <div class="tanques-chips">
                                    <noscript>
                                        <span class="tanque-chip">{% if os.tanques %}{{ os.tanques }}{% else %}{{ os.tanque }}{% endif %}</span>
                                    </noscript>
                                </div>
                            </td>
                            <td>{{ os.especificacao|default:"-" }}</td>
                            <td>{{ os.pob|default:"-" }}</td>
                            <td>{% if os.data_inicio %}{{ os.data_inicio|date:'d/m/Y' }}{% else %}-{% endif %}</td>
                            <td>{% if os.data_fim %}{{ os.data_fim|date:'d/m/Y' }}{% else %}-{% endif %}</td>
                            <td>{{ os.dias_de_operacao|default:"-" }}</td>
                            <td>{{ os.frente|default:"-" }}</td>
                            <td>{% if os.data_inicio_frente %}{{ os.data_inicio_frente|date:'d/m/Y' }}{% else %}-{% endif %}</td>
                            <td>{% if os.data_fim_frente %}{{ os.data_fim_frente|date:'d/m/Y' }}{% else %}-{% endif %}</td>
                            <td>{{ os.dias_de_operacao_frente|default:"-" }}</td>
                            <td>{{ os.turno|default:"-" }}</td>
                            <td>{{ os.solicitante|default:"-" }}</td>
                            <td>{{ os.supervisor|default:"-" }}</td>
                            <td>{{ os.coordenador|default:"-" }}</td>
                            <td>{{ os.po|default:"-" }}</td>
                            <td>{{ os.status_geral|default:"-" }}</td>
                            <td>{{ os.status_planejamento|default:"-" }}</td>
                            <td>{{ os.status_operacao|default:"-" }}</td>
                            <td>{{ os.material|default:"-" }}</td>
                            <td>{{ os.status_comercial|default:"-" }}</td>
                            <td>{{ os.status_databook|default:"-" }}</td>
                            <td>{{ os.numero_certificado|default:"-" }}</td>
                            <td>
                                <button class="btn_tabela btn-editar" data-id="{{ os.id }}" onclick="abrirModalEdicao('{{ os.id }}')">
                                    <svg viewBox="0 0 512 512">
                                        <path d="M410.3 231l11.3-11.3-33.9-33.9-62.1-62.1L291.7 89.8l-11.3 11.3-22.6 22.6L58.6 322.9c-10.4 10.4-18 23.3-22.2 37.4L1 480.7c-2.5 8.4-.2 17.5 6.1 23.7s15.3 8.5 23.7 6.1l120.3-35.4c14.1-4.2 27-11.8 37.4-22.2L387.7 253.7 410.3 231zM160 399.4l-9.1 22.7c-4 3.1-8.5 5.4-13.3 6.9L59.4 452l23-78.1c1.4-4.9 3.8-9.4 6.9-13.3l22.7-9.1v32c0 8.8 7.2 16 16 16h32zM362.7 18.7L348.3 33.2 325.7 55.8 314.3 67.1l33.9 33.9 62.1 62.1 33.9 33.9 11.3-11.3 22.6-22.6 14.5-14.5c25-25 25-65.5 0-90.5L453.3 18.7c-25-25-65.5-25-90.5 0zm-47.4 168l-144 144c-6.2 6.2-16.4 6.2-22.6 0s-6.2-16.4 0-22.6l144-144c6.2-6.2 16.4-6.2 22.6 0s6.2 16.4 0 22.6z" />
                                    </svg>
                                </button>
                            </td>
                             <td>
                                <button class="btn_tabela" id="btn_logistica_{{ os.id }}" data-id="{{ os.id }}" onclick="abrirLogisticaModal(this.dataset.id)"> 
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-seam-fill" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd" d="M15.528 2.973a.75.75 0 0 1 .472.696v8.662a.75.75 0 0 1-.472.696l-7.25 2.9a.75.75 0 0 1-.557 0l-7.25-2.9A.75.75 0 0 1 0 12.331V3.669a.75.75 0 0 1 .471-.696L7.443.184l.01-.003.268-.108a.75.75 0 0 1 .558 0l.269.108.01.003zM10.404 2 4.25 4.461 1.846 3.5 1 3.839v.4l6.5 2.6v7.922l.5.2.5-.2V6.84l6.5-2.6v-.4l-.846-.339L8 5.961 5.596 5l6.154-2.461z"/>
                                    </svg>
                                </button>
                            </td>
                            <td>
                                <button class="btn_tabela" id="btn_detalhes_{{ os.id }}" data-id="{{ os.id }}" onclick="abrirDetalhesModal('{{ os.id }}')"> 
                                      <svg class="plusIcon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30">
                                        <g mask="url(#mask0_21_345)">
                                        <path d="M13.75 23.75V16.25H6.25V13.75H13.75V6.25H16.25V13.75H23.75V16.25H16.25V23.75H13.75Z"></path>
                                        </g>
                                    </svg>
                                </button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            
            <div class="pagina">
                <div class="page-controls-top">
                    <div class="per-page-control">
                        <label for="per-page-select">Linhas por p√°gina:</label>
                        <select id="per-page-select" name="per_page" onchange="(function(){var v=this.value;var q=new URLSearchParams(window.location.search);q.set('per_page',v);q.set('page',1);window.location.href = window.location.pathname + '?' + q.toString();}).call(this)">
                            <option value="6"{% if per_page_current == 6 %} selected{% endif %}>6</option>
                            <option value="12"{% if per_page_current == 12 %} selected{% endif %}>12</option>
                            <option value="24"{% if per_page_current == 24 %} selected{% endif %}>24</option>
                            <option value="48"{% if per_page_current == 48 %} selected{% endif %}>48</option>
                            <option value="100"{% if per_page_current == 100 %} selected{% endif %}>100</option>
                        </select>
                    </div>
                    <!-- Page info removed for home layout (not needed) -->
                     
                {% load query_transform %}
                {% load pagination_tags %}
                {% with request.GET|query_transform:'page' as query_params %}
                    <div class="pagination-controls">
                    {% if servicos.has_previous %}
                            <a href="?page={{ servicos.previous_page_number }}{% if query_params %}&{{ query_params }}{% endif %}" class="btn_os pagina-btn-link page-arrow">‚Üê</a>
                    {% else %}
                        <span class="pagina-btn disabled page-arrow">‚Üê</span>
                    {% endif %}

                    {% paginate_range servicos as pages %}
                    <div class="page-numbers">
                        {% for p in pages %}
                            {% if p == '...' %}
                                <span class="page-number ellipsis">‚Ä¶</span>
                            {% elif p == servicos.number %}
                                <span class="page-number active" style="background-color: var(--cor1);">{{ p }}</span>
                            {% else %}
                                <a href="?page={{ p }}{% if query_params %}&{{ query_params }}{% endif %}" class="page-number">{{ p }}</a>
                            {% endif %}
                        {% endfor %}
                    </div>

                    {% if servicos.has_next %}
                            <a href="?page={{ servicos.next_page_number }}{% if query_params %}&{{ query_params }}{% endif %}" class="btn_os pagina-btn-link page-arrow">‚Üí</a>
                    {% else %}
                        <span class="pagina-btn disabled page-arrow">‚Üí</span>
                    {% endif %}
                    </div>
                {% endwith %}
                </div>
            </div>
            
            <div class="botoes_tabela">
                <a href="/exportar_excel/" class="btn_os" id="exportar_excel">Exportar para Excel</a>
            </div>
        </aside>


        <div id="modal-edicao" class="modal">
                <div class="modal-content modal-edicao">
                <span class="close-btn" onclick="fecharModalEdicao()">&times;</span>
                <h2>Editar Ordem de Servi√ßo</h2>
                
                <div class="campos-nao-editaveis">
                    <h3>Informa√ß√µes do Sistema</h3>
                    <div class="campo-info">
                        <label><strong>N√∫mero da OS:</strong></label>
                        <span id="edit_num_os" class="valor-fixo"></span>
                    </div>
                    <div class="campo-info">
                        <label><strong>ID:</strong></label>
                        <span id="edit_id_os" class="valor-fixo"></span>
                    </div>
                </div>

                <form id="form-edicao" method="post" action="{% url 'editar_os_post' %}">
                    {% csrf_token %}
                    <input type="hidden" id="edit_os_id" name="os_id">
                    
                    <fieldset class="form-section">
                        <legend>Cliente</legend>
                        <div class="campo-preenchimento">
                            <label for="edit_cliente">Cliente:</label>
                            <input type="text" id="edit_cliente" name="cliente" class="form-control" list="clientes_datalist" placeholder="Selecione um cliente cadastrado" required autocomplete="off">
                        </div>
                        <div class="campo-preenchimento">
                            <label for="edit_unidade">Unidade/Embarca√ß√£o:</label>
                            <input type="text" id="edit_unidade" name="unidade" class="form-control" list="unidades_datalist" placeholder="Selecione uma unidade cadastrada" required autocomplete="off">
                        </div>
                        <div class="campo-preenchimento">
                            <label for="edit_solicitante">Solicitante:</label>
                            <input type="text" id="edit_solicitante" name="solicitante" class="form-control" required>
                        </div>
                    </fieldset>

                    <fieldset class="form-section">
                        <legend>Opera√ß√£o</legend>
                        <div class="campo-preenchimento">
                            <label for="edit_servico_input">Servi√ßo (selecione um ou mais)</label>
                            <input type="text" id="edit_servico_input" class="form-control" list="servicos_datalist" placeholder="Selecione servi√ßos (aperte Enter ou +)" autocomplete="off">
                            <input type="hidden" id="edit_servico_hidden" name="servico" value="">
                            <div id="edit_servico_tags_container" class="tags-container"></div>
                            <div id="edit_tanques_container" class="tanques-container"></div>
                            <input type="hidden" id="edit_tanques_hidden" name="tanques" value="">
                        </div>
                        <div class="campo-preenchimento">
                            <label for="edit_metodo">M√©todo:</label>
                            <select id="edit_metodo" name="metodo" class="form-control" required>
                                {% for value, label in form.metodo.field.choices %}
                                    <option value="{{ value }}">{{ label }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="campo-preenchimento">
                            <label for="edit_metodo_secundario">M√©todo Secund√°rio:</label>
                            <select id="edit_metodo_secundario" name="metodo_secundario" class="form-control">
                                <option value="">---</option>
                                {% for value, label in form.metodo_secundario.field.choices %}
                                    <option value="{{ value }}">{{ label }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="campo-preenchimento">
                            <!-- Campo legado de compatibilidade: oculto para evitar confus√£o. Usamos m√∫ltiplos tanques em `edit_tanques_container` -->
                            <div style="display:none;">
                                <label for="edit_tanque">Tanque:</label>
                                <input type="text" id="edit_tanque" name="tanque" class="form-control">
                            </div>
                        </div>
                        <div class="campo-preenchimento">
                            <label for="edit_po">PO:</label>
                            <input type="text" id="edit_po" name="po" class="form-control" placeholder="N√∫mero PO">
                        </div>
                        <div class="campo-preenchimento">
                            <label for="edit_material">Material:</label>
                            <select id="edit_material" name="material" class="form-control">
                                <option value="">---</option>
                                <option value="A Bordo">A Bordo</option>
                                <option value="Embarcar">Embarcar</option>
                                <option value="Desembarcar">Desembarcar</option>
                            </select>
                        </div>
                        <div class="campo-preenchimento">
                            <label for="edit_especificacao">Especifica√ß√£o:</label>
                            <textarea id="edit_especificacao" name="especificacao" class="form-control" rows="3"></textarea>
                        </div>
                        <div class="campo-preenchimento">
                            <label for="edit_tipo_operacao">Regime de Opera√ß√£o:</label>
                            <select id="edit_tipo_operacao" name="tipo_operacao" class="form-control" required>
                                {% for value, label in form.tipo_operacao.field.choices %}
                                    <option value="{{ value }}">{{ label }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="campo-preenchimento">
                            <label for="edit_turno">Turno:</label>
                            <select id="edit_turno" name="turno" class="form-control">
                                <option value="">---</option>
                                <option value="Diurno">Diurno</option>
                                <option value="Noturno">Noturno</option>
                            </select>
                        </div>
                        <div class="campo-preenchimento">
                            <label for="edit_status_operacao">Status da opera√ß√£o:</label>
                            <select id="edit_status_operacao" name="status_operacao" class="form-control" required>
                                {% for value, label in form.status_operacao.field.choices %}
                                    <option value="{{ value }}">{{ label }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="campo-preenchimento">
                            <label for="edit_status_geral">Status da movimenta√ß√£o:</label>
                            <select id="edit_status_geral" name="status_geral" class="form-control" required>
                                {% for value, label in form.status_geral.field.choices %}
                                    <option value="{{ value }}">{{ label }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="campo-preenchimento">
                            <label for="edit_status_planejamento">Status Planejamento:</label>
                            <select id="edit_status_planejamento" name="status_planejamento" class="form-control">
                                {% for value, label in form.status_planejamento.field.choices %}
                                    <option value="{{ value }}">{{ label }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="campo-preenchimento">
                            <label for="edit_status_comercial">Medi√ß√£o Realizada?</label>
                            <select id="edit_status_comercial" name="status_comercial" class="form-control" required>
                                {% for value, label in form.status_comercial.field.choices %}
                                    <option value="{{ value }}">{{ label }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="campo-preenchimento">
                            <label for="edit_status_databook">Status Databook</label>
                            <select id="edit_status_databook" name="status_databook" class="form-control">
                                <option value="">---</option>
                                <option value="N√£o Aplic√°vel">N√£o Aplic√°vel</option>
                                <option value="Em Andamento">Em Andamento</option>
                                <option value="Finalizado">Finalizado</option>
                            </select>
                        </div>
                        <div class="campo-preenchimento">
                            <label for="edit_numero_certificado">N√∫mero do Certificado</label>
                            <input type="number" id="edit_numero_certificado" name="numero_certificado" class="form-control" placeholder="N√∫mero do certificado" inputmode="numeric" pattern="\d*" step="1">
                        </div>
                    </fieldset>

                    <fieldset class="form-section">
                        <legend>Datas</legend>
                        <div class="campo-preenchimento">
                            <label for="edit_data_inicio">Data In√≠cio da opera√ß√£o(programada):</label>
                            <input type="date" id="edit_data_inicio" name="data_inicio" class="form-control" required>
                        </div>
                        <div class="campo-preenchimento">
                            <label for="edit_data_fim">Data Fim da opera√ß√£o:</label>
                                <input type="date" id="edit_data_fim" name="data_fim" class="form-control">
                        </div>
                        <div class="campo-preenchimento">
                            <label for="edit_data_inicio_frente">Data In√≠cio da movimenta√ß√£o</label>
                            <input type="date" id="edit_data_inicio_frente" name="data_inicio_frente" class="form-control">
                        </div>
                        <div class="campo-preenchimento">
                            <label for="edit_data_fim_frente">Data Fim da movimenta√ß√£o</label>
                            <input type="date" id="edit_data_fim_frente" name="data_fim_frente" class="form-control">
                        </div>
                        <!-- campo 'frente' gerenciado automaticamente pelo sistema; removido do formul√°rio de edi√ß√£o -->
                    </fieldset>

                    <fieldset class="form-section">
                        <legend>Equipe</legend>
                        <div class="campo-preenchimento">
                            <label for="edit_pob">POB:</label>
                            <input type="number" id="edit_pob" name="pob" class="form-control" required>
                        </div>
                        <div class="campo-preenchimento">
                            <label for="edit_coordenador">Coordenador - Ambipar:</label>
                            <select id="edit_coordenador" name="coordenador" class="form-control" required>
                                {% for value, label in form.coordenador.field.choices %}
                                    <option value="{{ value }}">{{ label }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="campo-preenchimento">
                            <label for="edit_supervisor">Supervisor:</label>
                            {% if form.supervisor %}
                                {{ form.supervisor }}
                            {% else %}
                                <input type="text" id="edit_supervisor" name="supervisor" class="form-control" required>
                            {% endif %}
                        </div>
                    </fieldset>
                    <!-- Fieldset 1: Hist√≥rico de Observa√ß√µes (somente leitura) -->
                    <fieldset class="form-section">
                        <legend>Hist√≥rico de Observa√ß√µes</legend>
                        <div class="historico-card">
                            <div class="campo-preenchimento">
                                <label for="historico_observacoes">Hist√≥rico de Observa√ß√µes:</label>
                                <pre id="historico_observacoes" class="form-control">Nenhuma observa√ß√£o registrada.</pre>
                                <!-- Campo auxiliar (compatibilidade): algumas rotinas JS usam #edit_observacoes -->
                                <textarea id="edit_observacoes" name="edit_observacoes" style="display:none;"></textarea>
                            </div>
                        </div>
                    </fieldset>

                    <!-- Fieldset 2: Observa√ß√µes (entrada de nova observa√ß√£o) -->
                    <fieldset class="form-section">
                        <legend>Observa√ß√µes</legend>
                        <div class="nova-observacao-card">
                            <div class="campo-preenchimento">
                                <label for="nova_observacao">Adicionar nova observa√ß√£o:</label>
                                <textarea id="nova_observacao" name="nova_observacao" class="form-control" rows="3" placeholder="Digite uma nova observa√ß√£o"></textarea>
                            </div>
                        </div>
                    </fieldset>

                    <div class="botoes-modal">
                        <button type="submit" class="btn-confirmar">Salvar Altera√ß√µes</button>
                        <button type="button" class="btn-cancelar" onclick="fecharModalEdicao()">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>

        <aside>
            <div id="detalhes_os" class="detalhes">
                <div class="modal-detalhes">
                    <div id="relatorio-os">
                        <span class="close-btn" onclick="fecharDetalhesModal()">&times;</span>
                        <h2>Relat√≥rio de Ordem de Servi√ßo</h2>
                        <div id="notificacao-exportar-pdf" class="notificacao-exportar-pdf">
                            <div class="notificacao-header">
                                <span class="notificacao-icone-pdf" aria-label="PDF">
                                    <svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <rect x="4" y="4" width="20" height="20" rx="5" fill="#19c37d"/>
                                        <rect x="7.5" y="8.5" width="13" height="11" rx="2" fill="#fff"/>
                                        <rect x="9.5" y="10.5" width="9" height="2" rx="1" fill="#19c37d"/>
                                        <rect x="9.5" y="14.5" width="6" height="1.5" rx="0.75" fill="#19c37d"/>
                                        <rect x="9.5" y="17.5" width="4" height="1.5" rx="0.75" fill="#19c37d"/>
                                        <rect x="15.5" y="14.5" width="3" height="4.5" rx="1.2" fill="#19c37d"/>
                                    </svg>
                                </span>
                                <span class="notificacao-titulo">Deseja exportar os detalhes para PDF?</span>
                            </div>
                            <div class="notificacao-actions">
                                <button id="confirmar-exportar-pdf" class="btn-confirmar">Exportar agora</button>
                            </div>
                        </div>
                        <div class="secao">
                            <h3>Informa√ß√µes Gerais</h3>
                            <div class="grid-detalhes">
                                <div><strong>N√∫mero da OS:</strong> <span id="num_os"></span></div>
                                <div><strong>Contrato/PO:</strong> <span id="po"></span></div>
                                <div><strong>ID:</strong> <span id="id_os"></span></div>
                                <div><strong>Status da opera√ß√£o:</strong> <span id="status_os"></span></div>
                                <div><strong>Medi√ß√£o Realizada?</strong> <span id="status_comercial"></span></div>
                                <div><strong>Turno:</strong> <span id="turno"></span></div>
                                <div><strong>Status Databook:</strong> <span id="status_databook"></span></div>
                                <div><strong>N√∫mero do Certificado:</strong> <span id="numero_certificado"></span></div>
                            </div>
                        </div>
                        <div class="secao">
                            <h3>Datas</h3>
                            <div class="grid-detalhes">
                                <div><strong>Data In√≠cio da opera√ß√£o (programada):</strong> <span id="data_inicio"></span></div>
                                <div><strong>Data Fim da opera√ß√£o:</strong> <span id="data_fim"></span></div>
                                <div><strong>Dias de opera√ß√£o:</strong> <span id="dias_op"></span></div>
                                <div><strong>Data In√≠cio da movimenta√ß√£o:</strong> <span id="data_inicio_frente"></span></div>
                                <div><strong>Data Fim da movimenta√ß√£o:</strong> <span id="data_fim_frente"></span></div>
                                <div><strong>Dias da movimenta√ß√£o:</strong> <span id="dias_op_frente"></span></div>
                            </div>
                        </div>
                        <div class="secao">
                            <h3>Cliente e Local</h3>
                            <div class="grid-detalhes">
                                <div><strong>Cliente:</strong> <span id="cliente"></span></div>
                                <div><strong>Unidade:</strong> <span id="unidade"></span></div>
                                <div><strong>Solicitante:</strong> <span id="solicitante"></span></div>
                            </div>
                        </div>
                        <div class="secao">
                            <h3>Servi√ßo e Opera√ß√£o</h3>
                            <div class="servicos-grid">
                                <div class="servicos-left">
                                    <div class="box">
                                        <div class="field-label"><strong>Servi√ßo(s)</strong></div>
                                        <div id="servicos_full" class="servicos-box"></div>
                                    </div>
                                </div>
                                <div class="servicos-right">
                                    <div class="box"><strong>Regime da Opera√ß√£o:</strong> <span id="regime"></span></div>
                                    <div class="box"><strong>M√©todo da opera√ß√£o:</strong> <span id="metodo"></span></div>
                                    <div class="box"><strong>M√©todo Secund√°rio:</strong> <span id="metodo_secundario"></span></div>
                                </div>
                            </div>
                        </div>
                        <div class="secao">
                            <h3>Material</h3>
                            <div class="grid-detalhes">
                                <div><strong>Material:</strong> <span id="material"></span></div>
                            </div>
                        </div>
                        <div class="secao">
                            <h3>Tanque</h3>
                            <div class="grid-detalhes">
                                <div><strong>Tanque:</strong> <span id="tanque"></span></div>
                                <div><strong>Especifica√ß√£o:</strong> <span id="especificacao"></span></div>
                            </div>
                        </div>
                        <div class="secao">
                            <h3>Equipe</h3>
                            <div class="grid-detalhes">
                                <div><strong>POB:</strong> <span id="pob"></span></div>
                                <div><strong>Coordenador:</strong> <span id="coordenador"></span></div>
                                <div><strong>Supervisor:</strong> <span id="supervisor"></span></div>
                            </div>
                        </div>
                        <div class="secao">
                            <h3>Hist√≥rico:</h3>
                            <div class="observacao">
                                <span id="observacao" rowspan="4"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </aside>
    </main>
    <footer>
        <a href="{% url 'creditos' %}" title="Ver cr√©ditos dos desenvolvedores">
            <p>¬© 2026 Ambipar - v1.1</p>
        </a>
    </footer>
    <script src="{% static 'js/scripts.js'%}"></script>
    <script src="{% static 'js/notifications.js' %}"></script>
    <script src="{% static 'js/logistica.js' %}"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{% static 'js/dashboard.js' %}"></script>
    <script src="{% static 'js/os-popover.js' %}"></script>
    <div class="dashboard-fab edge-tab" id="dashboard-fab">
        <button id="btn_dashboard_toggle" class="dashboard-fab-btn" title="Abrir Dashboard" aria-label="Abrir Dashboard">
            <span class="material-icons" aria-hidden="true">analytics</span>
            <span class="fab-label">Dashboard</span>
        </button>
    </div>
    
</body>
</html>